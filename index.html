<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Felotus</title>
    <link rel="stylesheet" href="style.css">
    <!-- 引入 Font Awesome 图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- [新增] 引入 Cropper.js 的 CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.css">
</head>
<body>

    <div class="app-container">
        <!-- [修改] 状态栏现在由JS动态载入 -->
        <div id="status-bar-container"></div>

        <!-- 侧边栏菜单 -->
        <div class="sidebar-menu">
            <div class="sidebar-background"></div>
            <div class="sidebar-content">
                <div class="sidebar-top-actions">
                    <button class="action-btn"><i class="fa-solid fa-calendar-day"></i> 纪念日</button>
                    <button class="action-btn">
                        <i class="fa-solid fa-arrows-rotate"></i> 切换人设
                    </button>
                    <button class="action-btn" id="close-sidebar-btn"><i class="fa-solid fa-xmark"></i></button>
                </div>
                
                <div class="sidebar-profile-card" id="sidebar-profile-link"> 
                    <div class="profile-info">
                        <img src="https://i.imgur.com/Jz9v5aB.png" alt="avatar" class="avatar">
                        <div class="profile-details">
                            <div class="profile-name">用户</div>
                            <div class="profile-status">我的心是旷野的鸟，在你的眼…</div>
                        </div>
                        <i class="fa-solid fa-chevron-right"></i>
                    </div>
                </div>

                <div class="sidebar-nav-list">
    <a href="#" class="nav-item" id="sidebar-api-link"><i class="fa-solid fa-plug"></i><span>API</span><i class="fa-solid fa-chevron-right"></i></a>
    <!-- [新增] “注入”菜单项 -->
    <a href="#" class="nav-item" id="sidebar-inject-link"><i class="fa-solid fa-wand-magic-sparkles"></i><span>注入</span><i class="fa-solid fa-chevron-right"></i></a>
    <!-- [修改] 为“收藏”等菜单项添加 id -->
    <a href="#" class="nav-item" id="sidebar-favorites-link"><i class="fa-solid fa-star"></i><span>收藏</span><i class="fa-solid fa-chevron-right"></i></a>
    <a href="#" class="nav-item" id="sidebar-beautify-link"><i class="fa-solid fa-palette"></i><span>美化</span><i class="fa-solid fa-chevron-right"></i></a>
    <a href="#" class="nav-item" id="sidebar-wallet-link"><i class="fa-solid fa-wallet"></i><span>钱包</span><i class="fa-solid fa-chevron-right"></i></a>
    <a href="#" class="nav-item" id="sidebar-special-link"><i class="fa-solid fa-gem"></i><span>特殊</span><i class="fa-solid fa-chevron-right"></i></a>
    <a href="#" class="nav-item" id="sidebar-data-link"><i class="fa-solid fa-download"></i><span>数据</span><i class="fa-solid fa-chevron-right"></i></a>
</div>

                <div class="sidebar-bottom-actions">
                    <button><i class="fa-solid fa-gear"></i><span>设置</span></button>
                    <button id="btn-open-weather-modal"><i class="fa-solid fa-cloud"></i><span>天气</span></button>
                    <button id="btn-open-location-modal"><i class="fa-solid fa-location-dot"></i><span>定位</span></button>
                </div>
            </div>
        </div>
        
        <!-- 遮罩层 -->
        <div class="sidebar-overlay"></div>

        <!-- 主体内容包裹器 -->
        <div class="main-content-wrapper">
            <!-- 页面内容区域 -->
            <main class="main-content">
                <!-- 消息页面 -->
                <div id="page-messages" class="page active">
                    <header class="page-header">
                        <div class="user-info">
                            <img src="https://i.imgur.com/uG2g8xX.png" alt="avatar" class="avatar js-open-sidebar">
                            <div class="user-details-header">
                                <div class="header-username">用户</div>
                                <div class="header-status" id="header-status-trigger">
                                    <span id="header-status-text">在线</span>
                                </div>
                            </div>
                        </div>
                        <div class="header-actions">
                            <i class="fa-solid fa-plus" id="header-plus-btn"></i>
                        </div>

                        <!-- 头部弹出菜单 -->
                        <div class="popover-menu" id="header-popover-menu">
                            <div class="popover-item" id="btn-create-character">
                                <i class="fa-solid fa-user-plus"></i>
                                <span>创建角色</span>
                            </div>
                            <div class="popover-item">
                                <i class="fa-solid fa-users"></i>
                                <span>创建群聊</span>
                            </div>
                            <div class="popover-item">
                                <i class="fa-solid fa-check-double"></i>
                                <span>一键多选</span>
                            </div>
                        </div>
                    </header>
                    <div class="search-bar messages-search-bar">
                        <i class="fa-solid fa-magnifying-glass"></i>
                        <span>搜索</span>
                    </div>
                    <!-- [修改] 清空 chat-list，由 JS 动态填充 -->
                    <div class="chat-list">
                        <!-- 动态内容将在这里生成 -->
                    </div>
                </div>

                <!-- 角色页面 -->
                <div id="page-contacts" class="page">
                    <header class="page-header"><div class="page-title js-open-sidebar">角色</div><div class="header-actions"><i class="fa-solid fa-ellipsis-vertical"></i></div></header>
                    <div class="search-bar contacts-search-bar"><i class="fa-solid fa-magnifying-glass"></i><span>搜索</span></div>
                    <div class="contact-groups">
                        <div class="group-item new-friend-group-item"><div class="group-header new-friend-item"><div>新朋友</div><i class="fa-solid fa-chevron-right"></i></div></div>
                        <div class="contact-tabs"><button class="contact-tab-btn active" data-target="tab-content-groups">分组</button><button class="contact-tab-btn" data-target="tab-content-group-chats">群聊</button></div>
                        <div class="tab-content-wrapper">
                            <div id="tab-content-groups" class="contact-tab-content active">
                                <div class="group-item">
                                    <div class="group-header">
                                        <div><i class="fa-solid fa-chevron-right"></i> <span class="group-name">特别关心</span></div>
                                        <span class="group-count">0</span>
                                    </div>
                                </div>
                                <div class="group-item">
                                    <div class="group-header">
                                        <div><i class="fa-solid fa-chevron-right"></i> <span class="group-name">默认分组</span></div>
                                        <!-- [修改] 为数量span添加ID -->
                                        <span class="group-count" id="default-group-count">0</span>
                                    </div>
                                    <!-- [新增] 为默认分组下的角色列表添加容器 -->
                                    <div class="contact-list" id="default-group-contacts">
                                        <!-- 角色列表将在这里动态生成 -->
                                    </div>
                                </div>
                            </div>
                            <div id="tab-content-group-chats" class="contact-tab-content">
                                <div class="group-item"><div class="group-header"><div><i class="fa-solid fa-chevron-right"></i> <span class="group-name">我创建的群聊</span></div><span class="group-count">1</span></div></div>
                                <div class="group-item"><div class="group-header"><div><i class="fa-solid fa-chevron-right"></i> <span class="group-name">我加入的群聊</span></div><span class="group-count">1</span></div></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 组件页面 -->
                <div id="page-tools" class="page">
                    <header class="page-header"><div class="page-title js-open-sidebar">组件</div></header>
                    <div class="tools-page-content">
                        <div class="tool-category">
                            <h3 class="tool-category-title">功能类</h3>
                            <div class="actions-grid"><div class="action-item"><i class="fa-solid fa-book-open"></i><span>小说</span></div><div class="action-item"><i class="fa-solid fa-music"></i><span>音乐</span></div><div class="action-item"><i class="fa-solid fa-book-journal-whills"></i><span>日记</span></div><div class="action-item"><i class="fa-solid fa-users-line"></i><span>菲洛图论坛</span></div><div class="action-item"><i class="fa-solid fa-hourglass-half"></i><span>专注陪伴</span></div><div class="action-item"><i class="fa-solid fa-map-pin"></i><span>记忆点</span></div></div>
                        </div>
                        <div class="tool-category">
                            <h3 class="tool-category-title">休闲类</h3>
                            <div class="actions-grid"><div class="action-item"><i class="fa-solid fa-egg"></i><span>扭蛋</span></div><div class="action-item"><i class="fa-solid fa-leaf"></i><span>农场</span></div><div class="action-item"><i class="fa-solid fa-paw"></i><span>宠物</span></div><div class="action-item"><i class="fa-solid fa-utensils"></i><span>烹饪</span></div></div>
                        </div>
                        <div class="tool-category">
                            <h3 class="tool-category-title">桌游类</h3>
                            <div class="actions-grid"><div class="action-item"><i class="fa-solid fa-user-secret"></i><span>谁是卧底</span></div><div class="action-item"><i class="fa-solid fa-moon"></i><span>狼人杀</span></div><div class="action-item"><i class="fa-solid fa-comments"></i><span>真心话</span></div><div class="action-item"><i class="fa-solid fa-plane"></i><span>飞行棋</span></div></div>
                        </div>
                    </div>
                </div>

                <!-- 长生树页面 -->
                <div id="page-tree" class="page">
                    <header class="page-header"><div class="page-title js-open-sidebar">长生树</div></header>
                    <div class="tree-container"><i class="fa-solid fa-tree"></i><p>长生树功能待开发...</p></div>
                </div>

                <!-- 动态页面 -->
                <div id="page-feed" class="page">
                    <header class="page-header"><div class="page-title js-open-sidebar">动态</div><div class="header-actions"><i class="fa-solid fa-gear"></i></div></header>
                    <div class="feed-content">
        <div class="feed-profile-banner">
            <!-- [修改] 为动态页的头像 img 标签添加 id，并统一默认头像 -->
            <img src="https://i.imgur.com/uG2g8xX.png" alt="avatar" class="avatar" id="feed-avatar">
            <div class="feed-user-info">
                <span>用户</span></div><i class="fa-solid fa-chevron-right"></i></div>
                        <div class="actions-grid"><div class="action-item"><i class="fa-solid fa-image"></i><span>带图片</span></div><div class="action-item"><i class="fa-solid fa-comment-dots"></i><span>仅文字</span></div><div class="action-item"><i class="fa-solid fa-grip"></i><span>更多</span></div></div>
                        <div class="feed-card"><div class="feed-card-header"><img src="https://picsum.photos/seed/user5/100/100" alt="avatar"><div class="author-info"><div class="author-name">测试</div><div class="post-time">今天 12:00</div></div><i class="fa-solid fa-ellipsis"></i></div><div class="feed-card-body"><p>这是一条测试帖子</p><div class="shared-content">测试转发内容样式，功能还没做</div></div></div>
                    </div>
                </div>
            </main>

            <!-- 底部导航栏 -->
            <nav class="bottom-nav">
                <button class="nav-button active" data-target="page-messages"><i class="fa-solid fa-comment-dots"></i></button>
                <button class="nav-button" data-target="page-contacts"><i class="fa-solid fa-address-book"></i></button>
                <button class="nav-button" data-target="page-tree"><i class="fa-solid fa-tree"></i></button>
                <button class="nav-button" data-target="page-tools"><i class="fa-solid fa-toolbox"></i></button>
                <button class="nav-button" data-target="page-feed"><i class="fa-solid fa-star"></i></button>
            </nav>
        </div> <!-- End of main-content-wrapper -->

<!-- 用户设置页面层 -->
<div id="page-user-settings" class="page-overlay">
    <header class="user-settings-header">
        <i id="user-settings-back-btn" class="fa-solid fa-chevron-left"></i>
        <span>用户设置</span>
        <div class="user-settings-header-actions">
            <i id="user-settings-delete-btn" class="fa-solid fa-trash-can"></i>
            <i id="user-settings-save-btn" class="fa-solid fa-floppy-disk"></i>
        </div>
    </header>
    <div class="user-settings-content">
        <!-- [修改] 将静态标签替换为动态容器 -->
        <!-- [修改] 用户人设标签栏改为可水平滑动 -->
<div class="user-tags-container">
    <div id="user-profile-tags" class="user-settings-tags">
        <!-- 标签将由 JS 动态生成 -->
    </div>
    <div class="add-tag-button-container">
        <i class="fa-solid fa-plus" id="add-user-profile-btn"></i>
    </div>
</div>
        
<div class="settings-card profile-edit-card">
    <img src="https://i.imgur.com/uG2g8xX.png" alt="avatar" class="profile-avatar" id="user-avatar-preview">
    <input type="file" id="user-avatar-input" accept="image/*" style="display: none;">

    <div class="profile-details-inputs">
        <div class="input-row">
            <label>姓名</label>
            <input type="text" id="input-name" placeholder="你的名字">
        </div>
        <div class="input-row">
            <label>性别</label>
            <!-- [修改] 将性别输入框设为只读 -->
            <input type="text" id="input-gender" value="女" readonly>
        </div>
        <div class="input-row">
            <label>生日</label>
            <input type="text" placeholder="例如1.1" id="input-birthday">
        </div>
        <div class="input-row">
            <label>年龄</label>
            <input type="text" placeholder="例如20" id="input-age">
        </div>
    </div>
</div>

<!-- [新增] 应用范围卡片 (正确版本) -->
<div class="settings-card">
    <div class="settings-card-header">
        <div><i class="fa-solid fa-globe"></i> 应用范围</div>
    </div>
    <div class="settings-card-body">
        <div class="toggle-switch-item">
            <span>全局应用此设定</span>
            <label class="switch">
                <input type="checkbox" id="toggle-global-apply">
                <span class="slider round"></span>
            </label>
        </div>
        <!-- 角色绑定下拉菜单，默认隐藏 -->
        <div class="character-binding-container" id="character-binding-container">
            <span>绑定到指定角色</span>
            <select id="bind-character-select">
                <!-- 角色列表将由JS动态生成 -->
            </select>
        </div>
    </div>
</div>

        <div class="settings-card">
            <div class="settings-card-header">
                <div><i class="fa-solid fa-user"></i> 我的设定</div>
                <i class="fa-solid fa-expand"></i>
            </div>
            <div class="settings-card-body">
                <textarea placeholder="此处填写设定" id="textarea-settings"></textarea>
            </div>
        </div>
        <div class="settings-card">
            <div class="settings-card-header">
                <div><i class="fa-solid fa-pen-to-square"></i> 我的个性签名</div>
            </div>
            <div class="settings-card-body">
                <input type="text" placeholder="此处填写个性签名" id="input-signature">
            </div>
        </div>
        <div class="settings-nav-group">
            <a href="#" class="settings-nav-item">
                <div><i class="fa-solid fa-star"></i> 我的空间</div>
                <i class="fa-solid fa-chevron-right"></i>
            </a>
            <a href="#" class="settings-nav-item">
                <div><i class="fa-solid fa-gift"></i> 我的礼物墙</div>
                <i class="fa-solid fa-chevron-right"></i>
            </a>
        </div>
    </div>
</div>

        <!-- ==================== 新增: 角色设置页面层 ==================== -->
        <div id="page-character-settings" class="page-overlay">
            <header class="user-settings-header">
                <i id="character-settings-back-btn" class="fa-solid fa-chevron-left"></i>
                <span>角色设置</span>
                <i id="character-settings-save-btn" class="fa-solid fa-floppy-disk"></i>
            </header>
            <div class="user-settings-content">
                
                <div class="settings-card profile-edit-card">
                    <!-- [修改] 给 img 标签添加 id -->
                    <img src="https://i.imgur.com/Jz9v5aB.png" alt="avatar" class="profile-avatar" id="char-avatar-preview">
                    <!-- [新增] 隐藏的文件上传输入框 -->
                    <input type="file" id="char-avatar-input" accept="image/*" style="display: none;">

                    <div class="profile-details-inputs">
                        <div class="input-row">
                            <label>姓名</label>
                            <input type="text" id="input-char-name" placeholder="角色名字">
                        </div>
                        <div class="input-row">
                            <label>性别</label>
                            <input type="text" id="input-char-gender" placeholder="女/男/无">
                        </div>
                        <div class="input-row">
                            <label>生日</label>
                            <input type="text" placeholder="例如1.1" id="input-char-birthday">
                        </div>
                        <div class="input-row">
                            <label>年龄</label>
                            <input type="text" placeholder="例如20" id="input-char-age">
                        </div>
                    </div>
                <!-- ... 这是个人资料编辑卡片的结束标签 ... -->
</div>

<!-- ==================== [新增] 已绑定用户信息卡片 (默认隐藏) ==================== -->
<div class="settings-card hidden" id="bound-user-info-card">
    <div class="settings-nav-item">
        <div><i class="fa-solid fa-link"></i> 已绑定用户</div>
        <span id="bound-user-name"></span>
    </div>
</div>

<div class="settings-card">
<!-- ... 这是角色设定卡片的开始标签 ... -->
                    <div class="settings-card-header">
                        <div><i class="fa-solid fa-user"></i> 角色设定</div>
                        <i class="fa-solid fa-expand"></i>
                    </div>
                    <div class="settings-card-body">
                        <textarea placeholder="此处填写角色设定" id="textarea-char-settings"></textarea>
                    </div>
                </div>
                <div class="settings-card">
                    <div class="settings-card-header">
                        <div><i class="fa-solid fa-pen-to-square"></i> 角色个性签名</div>
                    </div>
                    <div class="settings-card-body">
                        <span class="placeholder-text">和角色聊点什么后再来看看吧</span>
                    </div>
                </div>
                <div class="settings-nav-group">
                    <a href="#" class="settings-nav-item">
                        <div><i class="fa-solid fa-star"></i> 角色空间</div>
                        <i class="fa-solid fa-chevron-right"></i>
                    </a>
                    <a href="#" class="settings-nav-item">
                        <div><i class="fa-solid fa-gift"></i> 角色礼物墙</div>
                        <i class="fa-solid fa-chevron-right"></i>
                    </a>
                </div>
            </div>
        </div>
        <!-- ==================== 角色设置页面层结束 ==================== -->


<!-- ==================== [新增] 全屏设定编辑器页面 ==================== -->
<div id="page-fullscreen-editor" class="page-overlay">
    <header class="user-settings-header">
        <i id="fullscreen-editor-back-btn" class="fa-solid fa-chevron-left"></i>
        <span>编辑设定</span>
        <i></i> <!-- 占位符，保持布局一致 -->
    </header>
    <div class="user-settings-content fullscreen-editor-content">
        <textarea id="fullscreen-editor-textarea" placeholder="在此处输入详细设定..."></textarea>
    </div>
</div>
<!-- ==================== 全屏设定编辑器页面结束 ==================== -->

        <!-- 数据管理页面 -->
        <div id="page-data-management" class="page-overlay">
            <header class="user-settings-header">
                <i id="data-management-back-btn" class="fa-solid fa-chevron-left"></i>
                <span>数据管理</span>
                <i></i> <!-- 占位符 -->
            </header>
            <div class="user-settings-content">
                <div class="data-actions-list">
                    <button id="btn-export-data" class="data-action-item">
                        <i class="fa-solid fa-file-export"></i>
                        <span>导出本地数据</span>
                    </button>
                    <button id="btn-import-data" class="data-action-item">
                        <i class="fa-solid fa-file-import"></i>
                        <span>导入本地数据</span>
                    </button>
                    <button id="btn-upload-cloud" class="data-action-item disabled">
                        <i class="fa-solid fa-cloud-arrow-up"></i>
                        <span>上传云端数据</span>
                    </button>
                    <!-- [新增] 清除本地数据按钮 -->
                    <button id="btn-clear-data" class="data-action-item danger">
                        <i class="fa-solid fa-trash-can"></i>
                        <span>清除本地数据</span>
                    </button>
                    <input type="file" id="import-file-input" accept=".json" style="display: none;">
                </div>
            </div>
        </div>
<!-- ==================== [新增] 五个空白页面层 ==================== -->
<!-- 注入页面 -->
<div id="page-inject" class="page-overlay">
    <!-- [修改] 为注入管理页面添加删除和保存图标 -->
<header class="user-settings-header">
    <!-- [修改] 为返回按钮添加 ID -->
    <i id="inject-settings-back-btn" class="fa-solid fa-chevron-left"></i>
    <span>注入管理</span>
    <div class="user-settings-header-actions">
        <!-- [新增] 删除提示词按钮 -->
        <i id="btn-delete-prompt" class="fa-solid fa-trash-can"></i>
        <!-- [新增] 保存提示词按钮 -->
        <i id="btn-save-prompt" class="fa-solid fa-floppy-disk"></i>
    </div>
</header>
    <div class="user-settings-content">

        <!-- [修改] 为选择提示词添加加号图标 -->
<div class="form-group">
    <div class="form-group-header">
        <label for="prompt-select">选择提示词 (可切换)</label>
        <i class="fa-solid fa-plus" id="btn-new-prompt-icon"></i>
    </div>
    <select id="prompt-select">
        <!-- 提示词将由JS动态生成 -->
    </select>
</div>

<!-- 卡片1: 对话设置 -->
<div class="settings-card inject-settings-card locked"> <!-- [修改] 添加 locked 类, 让其默认锁住 -->
    <div class="settings-card-header">
        对话设置
        <!-- [新增] 添加一个锁图标, 并给它一个ID -->
        <i id="toggle-inject-lock" class="fa-solid fa-lock"></i>
    </div>
    
    <!-- ... 下面的滑动条保持不变 ... -->
            
            <!-- 最大上下文长度 -->
            <div class="setting-item-vertical">
                <div class="setting-item-header">
                    <label for="inject-max-context-slider">最大上下文长度 <span class="range-hint">(52k ~ 1m)</span></label>
                    <input type="number" id="inject-max-context" class="slider-value-input" min="52000" max="1000000" step="1024">
                </div>
                <div class="slider-container">
                    <input type="range" id="inject-max-context-slider" min="52000" max="1000000">
                </div>
            </div>
            <!-- 最大回复长度 -->
            <div class="setting-item-vertical">
                <div class="setting-item-header">
                    <label for="inject-max-response-slider">最大回复长度 <span class="range-hint">(10 ~ 52k)</span></label>
                    <input type="number" id="inject-max-response" class="slider-value-input" min="10" max="52000" step="100">
                </div>
                <div class="slider-container">
                    <input type="range" id="inject-max-response-slider" min="10" max="52000">
                </div>
            </div>
            <!-- Temperature -->
            <div class="setting-item-vertical">
                <div class="setting-item-header">
                    <label for="inject-temp-slider">Temperature <span class="range-hint">(0.1 ~ 1.3)</span></label>
                    <input type="number" id="inject-temp-value" class="slider-value-input" min="0.1" max="1.3" step="0.01">
                </div>
                <div class="slider-container">
                    <input type="range" id="inject-temp-slider" min="0.1" max="1.3" step="0.01">
                </div>
            </div>
            <!-- Top P -->
            <div class="setting-item-vertical">
                <div class="setting-item-header">
                    <label for="inject-top-p-slider">Top P <span class="range-hint">(0.1 ~ 1.0)</span></label>
                    <input type="number" id="inject-top-p-value" class="slider-value-input" min="0.1" max="1.0" step="0.01">
                </div>
                <div class="slider-container">
                    <input type="range" id="inject-top-p-slider" min="0.1" max="1.0" step="0.01">
                </div>
            </div>
        </div>
        
        <!-- [修改] 将 .settings-nav-group 改为 .settings-card 以便添加标题 -->
        <div class="settings-card">
            <!-- [新增] 卡片标题 -->
            <div class="settings-card-header">选项设置</div>
            
            <div class="settings-nav-item">
                <label for="inject-ability-select">推理能力</label>
                <select id="inject-ability-select">
                    <option value="auto">auto</option>
                    <option value="minimum">minimum</option>
                    <option value="low">低</option>
                    <option value="medium">中</option>
                    <option value="high">高</option>
                    <option value="maximum">maximum</option>
                </select>
            </div>
            <div class="settings-nav-item">
                <label for="inject-mode-select">模式选择</label>
                <select id="inject-mode-select">
                    <!-- [修改] 更新下拉选项的文本 -->
                    <option value="chat">聊天模式-手机体</option>
                    <option value="story">剧情模式-小说体</option>
                </select>
            </div>
        </div>
    </div>
</div>

<!-- 收藏页面 -->
<div id="page-favorites" class="page-overlay">
    <header class="user-settings-header">
        <i class="fa-solid fa-chevron-left"></i>
        <span>收藏</span>
        <i></i> <!-- 占位符 -->
    </header>
    <div class="user-settings-content">
        <p>收藏功能待开发…</p>
    </div>
</div>

<!-- 美化页面 -->
<div id="page-beautify" class="page-overlay">
    <header class="user-settings-header">
        <i class="fa-solid fa-chevron-left"></i>
        <span>美化</span>
        <i></i> <!-- 占位符 -->
    </header>
    <div class="user-settings-content">
        <p>美化功能待开发…</p>
    </div>
</div>

<!-- 钱包页面 -->
<div id="page-wallet" class="page-overlay">
    <header class="user-settings-header">
        <i class="fa-solid fa-chevron-left"></i>
        <span>钱包</span>
        <i></i> <!-- 占位符 -->
    </header>
    <div class="user-settings-content">
        <p>钱包功能待开发…</p>
    </div>
</div>

<!-- 特殊页面 -->
<div id="page-special" class="page-overlay">
    <header class="user-settings-header">
        <i class="fa-solid fa-chevron-left"></i>
        <span>特殊</span>
        <i></i> <!-- 占位符 -->
    </header>
    <div class="user-settings-content">
        <p>特殊功能待开发…</p>
    </div>
</div>
<!-- ==================== 空白页面层结束 ==================== -->
        <!-- ==================== API 管理页面层 (V2.0 重构版) ==================== -->
        <div id="page-api-settings" class="page-overlay">
            <!-- [修正] 为 API 管理页面的 header 添加删除和保存图标 -->
<header class="user-settings-header">
    <i id="api-settings-back-btn" class="fa-solid fa-chevron-left"></i>
    <span>API 管理</span>
    <div class="user-settings-header-actions">
        <i id="btn-delete-config" class="fa-solid fa-trash-can"></i>
        <i id="btn-save-config" class="fa-solid fa-floppy-disk"></i>
    </div>
</header>
            <div class="user-settings-content">
                <form id="api-settings-form">
                    
                    <div class="form-group">
    <!-- [新增] 使用 flex 布局的容器 -->
    <div class="form-group-header">
        <label for="api-config-select">选择配置 (可切换)</label>
        <!-- [新增] 新的加号图标按钮 -->
        <i class="fa-solid fa-plus" id="btn-new-config-icon"></i>
    </div>
    <select id="api-config-select">
        <!-- 配置将由JS动态生成 -->
    </select>
</div>

                    <div class="form-group">
                        <label for="api-type-select">选择格式 (必选)</label>
                        <select id="api-type-select">
                            <option value="openai">兼容OpenAI</option>
                            <option value="gemini">Gemini Key</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="api-url">API 地址 (Base URL)</label>
                        <!-- [修改] 更新 placeholder 文本 -->
                        <input type="text" id="api-url" placeholder="https://example.com (不用加/v1)">
                    </div>
                    <div class="form-group">
                        <label for="api-key">密钥 (API Key)</label>
                        <input type="password" id="api-key" placeholder="请输入API Key">
                    </div>
                    <div class="form-group">
                        <label for="model-select">选择模型</label>
                        <select id="model-select">
                            <optgroup id="openai-models" label="OpenAI / 兼容"></optgroup>
                            <optgroup id="gemini-models" label="Google Gemini"></optgroup>
                        </select>
                    </div>

                    <!-- [修改] 移除 "新建配置" 按钮，只保留 "拉取模型" -->
<div class="api-actions-single">
    <button type="button" id="fetch-models-button-new" class="action-button">拉取模型</button>
</div>

                </form>
            </div>
        </div>
        <!-- ==================== API 管理页面层结束 ==================== -->

        <!-- 天气、定位、状态模态框 -->
<div class="modal-overlay-container" id="modal-container">
    <!-- 天气模态框 -->
    <div class="modal-panel" id="weather-modal">
        <div class="modal-header">
            <h3>选择天气</h3>
            <button class="modal-close-btn"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="modal-content">
            <div class="weather-grid" id="weather-options-grid">
                <!-- 天气选项将由 JS 动态生成 -->
            </div>
        </div>
    </div>
    
    <!-- 定位模态框 -->
    <div class="modal-panel" id="location-modal">
        <div class="modal-header">
            <h3>管理定位</h3>
            <button class="modal-close-btn"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="modal-content" id="location-cards-container">
            <!-- 定位卡片将由 JS 动态生成 -->
        </div>
        <div class="modal-footer">
            <button class="modal-action-btn" id="btn-add-location">
                <i class="fa-solid fa-plus"></i> 添加新定位
            </button>
        </div>
    </div>

    <!-- 状态模态框 -->
    <div class="modal-panel" id="status-modal">
        <div class="modal-header">
            <h3>选择状态</h3>
            <button class="modal-close-btn"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="modal-content">
            <div class="status-grid" id="status-options-grid">
                <!-- 状态选项将由 JS 动态生成 -->
            </div>
        </div>
    </div>
    
    <!-- [修复] 将清除数据模态框移入容器内 -->
    <div class="modal-panel" id="clear-data-modal">
        <div class="modal-header">
            <h3>确认清除数据</h3>
            <button class="modal-close-btn"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="modal-content">
            <p>此操作不可逆！将清除所有用户、角色、API及其他设置。</p>
            <p>请输入 <strong>delete</strong> 以确认：</p>
            <input type="text" id="clear-data-confirm-input" class="clear-data-input" autocomplete="off">
        </div>
        <div class="modal-footer">
            <button class="modal-action-btn danger" id="confirm-clear-data-btn" disabled>
                确认清除
            </button>
        </div>
    </div>
<!-- ==================== [新增] 图片剪裁模态框 ==================== -->
    <div class="modal-panel" id="cropper-modal">
        <div class="modal-header">
            <h3>移动和缩放图片</h3>
            <!-- 这个关闭按钮是可选的，因为我们有取消按钮 -->
            <button class="modal-close-btn" id="cancel-crop-btn"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="modal-content">
            <!-- 剪裁器将在这个容器内生成 -->
            <div class="cropper-image-container">
                <img id="image-to-crop" src="" alt="待剪裁的图片">
            </div>
        </div>
        <div class="modal-footer cropper-footer">
            <button class="modal-action-btn" id="confirm-crop-btn">确认剪裁</button>
        </div>
    </div> 
</div> <!-- End of modal-overlay-container -->

<!-- ==================== [新增] 对话界面 (正确位置) ==================== -->
<div id="page-chat-interface" class="page-overlay">
    <header class="user-settings-header">
        <i id="chat-interface-back-btn" class="fa-solid fa-chevron-left"></i>
        <span id="chat-interface-char-name">角色名称</span>
        <div class="header-actions">
            <i class="fa-solid fa-ellipsis-vertical"></i>
        </div>
    </header>
    <div class="chat-area">
        <div class="message-bubble received">
            <img src="https://i.imgur.com/Jz9v5aB.png" alt="avatar" class="message-avatar">
            <div class="message-content">
                <p>你好呀！我们已经是好友了，现在开始聊天吧！</p>
            </div>
        </div>
        <div class="message-bubble sent">
            <div class="message-content">
                <p>你好！很高兴认识你。</p>
            </div>
        </div>
    </div>
    <div class="chat-input-bar">
        <i class="fa-solid fa-microphone"></i>
        <input type="text" placeholder="发送消息...">
        <i class="fa-regular fa-face-smile"></i>
        <i class="fa-solid fa-circle-plus"></i>
    </div>
</div>
<!-- ==================== 对话界面结束 ==================== -->

<!-- [修正] 确保所有脚本只在文件末尾加载一次 -->
    <script src="config.js"></script>
    <script src="script.js"></script>
    <script src="statusBar.js"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.6.1/cropper.min.js"></script>
</body>
</html>